graph TB
    %% Client Layer
    Client[API Clients]
    WebApp[Web Application]

    %% Vercel Platform
    subgraph "Vercel Platform"
        VercelEdge[Vercel Edge Network]
        NextJS[Next.js Server Functions]
    end

    %% Next.js Application API Routes
    subgraph "Next.js API Routes"
        subgraph "Public Endpoints"
            HealthCheck[GET /api/health - Health Check]
            Revalidate[POST /api/revalidate - Cache Revalidation]
        end

        subgraph "Workflow Endpoints"
            WorkflowCars[GET /api/workflows/cars - Cars Workflow]
            WorkflowCOE[GET /api/workflows/coe - COE Workflow]
            WorkflowDereg[GET /api/workflows/deregistrations - Deregistrations Workflow]
        end

        subgraph "Internal APIs"
            OGImages[GET /api/og/* - OpenGraph Images]
            Analytics[POST /api/analytics - Analytics Events]
        end
    end

    %% WDK Workflow System
    subgraph "WDK Workflow Runtime"
        CarsWorkflow[Cars Data Workflow]
        COEWorkflow[COE Data Workflow]
        DeregWorkflow[Deregistrations Workflow]
        BlogGeneration[Blog Generation Step]
        SocialPosting[Social Media Step]
    end

    %% External Services
    subgraph "External Services"
        LTA[LTA DataMall APIs]
        Gemini[Vercel AI SDK + Google Gemini]
        Discord[Discord Webhook]
        LinkedIn[LinkedIn API]
        Telegram[Telegram Bot API]
        Twitter[Twitter API]
    end

    %% Data Layer
    subgraph "Data Layer"
        Neon[(Neon PostgreSQL)]
        Upstash[(Upstash Redis)]
        Blob[Vercel Blob Storage]
    end

    %% Cron Scheduler
    subgraph "Scheduling"
        VercelCron[Vercel Cron Jobs]
    end

    %% Request Flow Connections
    Client --> VercelEdge
    WebApp --> VercelEdge
    VercelEdge --> NextJS

    %% API Route connections
    NextJS --> HealthCheck
    NextJS --> Revalidate
    NextJS --> OGImages
    NextJS --> Analytics

    %% Workflow triggers
    NextJS --> WorkflowCars
    NextJS --> WorkflowCOE
    NextJS --> WorkflowDereg
    VercelCron --> WorkflowCars
    VercelCron --> WorkflowCOE
    VercelCron --> WorkflowDereg

    %% Workflow execution
    WorkflowCars --> CarsWorkflow
    WorkflowCOE --> COEWorkflow
    WorkflowDereg --> DeregWorkflow

    %% Workflow steps
    CarsWorkflow --> LTA
    CarsWorkflow --> Neon
    CarsWorkflow --> BlogGeneration
    CarsWorkflow --> SocialPosting

    COEWorkflow --> LTA
    COEWorkflow --> Neon
    COEWorkflow --> BlogGeneration
    COEWorkflow --> SocialPosting

    DeregWorkflow --> LTA
    DeregWorkflow --> Neon

    %% Blog generation
    BlogGeneration --> Gemini
    BlogGeneration --> Neon

    %% Social media
    SocialPosting --> Discord
    SocialPosting --> LinkedIn
    SocialPosting --> Telegram
    SocialPosting --> Twitter

    %% Data connections
    HealthCheck --> Neon
    Revalidate --> Upstash
    OGImages --> Blob

    %% Styling
    classDef endpoint fill:#e1f5fe
    classDef workflow fill:#fce4ec
    classDef external fill:#fff3e0
    classDef database fill:#e8f5e8
    classDef platform fill:#f3e5f5

    class HealthCheck,Revalidate,OGImages,Analytics,WorkflowCars,WorkflowCOE,WorkflowDereg endpoint
    class CarsWorkflow,COEWorkflow,DeregWorkflow,BlogGeneration,SocialPosting workflow
    class LTA,Gemini,Discord,LinkedIn,Telegram,Twitter external
    class Neon,Upstash,Blob database
    class VercelEdge,NextJS,VercelCron platform
